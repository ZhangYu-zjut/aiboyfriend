# AI Boyfriend â€“ IntimacyÂ EngineÂ MVPÂ Spec

> **ç›®æ ‡**ï¼šåœ¨ Discord æœºå™¨äºº MVP é˜¶æ®µï¼Œç”¨æœ€å°å¯è¡Œçš„ã€Œäº²å¯†åº¦å¼•æ“ (IntimacyÂ Engine)ã€åˆ›é€  *æ²‰æµ¸å¼æ‹çˆ±ä½“éªŒ*ï¼Œå¹¶éªŒè¯ç”¨æˆ·ä»˜è´¹æ„æ„¿ã€‚

---

## 1Â Â·Â ç›®æ ‡æ‹†è§£

| å±‚çº§ | ç›®æ ‡                 | å¯é‡åŒ–æŒ‡æ ‡               |
| -- | ------------------ | ------------------- |
| ä½“éªŒ | è®©ç”¨æˆ·æ„Ÿè§‰ã€Œè¢«ç†è§£ã€è¢«æƒ¦è®°ã€     | >70Â % ç•™å­˜åˆ°ç¬¬ 2 å¤© (D1) |
| ä¸šåŠ¡ | éªŒè¯é¦–å•ä»˜è´¹æ„æ„¿           | é¦–å•è½¬åŒ–ç‡ â‰¥Â 8Â %         |
| æŠ€æœ¯ | å•è½®å“åº” â‰¤Â 5Â sï¼Œ99Â % å¯ç”¨ | å¹³å‡å»¶æ—¶ã€é”™è¯¯ç‡            |

---

## 2Â Â·Â äº§å“éœ€æ±‚ (PRD)

### 2.1 Feature List (MVP Only)

| #   | Feature    | ç”¨æˆ·ä»·å€¼       | æŠ€æœ¯èŒƒå›´                           |
| --- | ---------- | ---------- | ------------------------------ |
| Fâ€‘1 | **æƒ…æ„Ÿè¯†åˆ«**   | AI ç”·å‹èƒ½ã€Œæ‡‚æˆ‘ã€ | 5â€‘label ä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»å™¨ + å…³é”®è¯å…œåº•        |
| Fâ€‘2 | **äº²å¯†åº¦å¢é•¿**  | ç”¨æˆ·çœ‹åˆ°å…³ç³»å˜äº²å¯†  | HETÂ â†’Â Î”Intimacy å…¬å¼ & è¿›åº¦æ¡ Embed |
| Fâ€‘3 | **æ˜µç§°å‡çº§**   | æ–°ç§°å‘¼å¸¦æ¥æƒŠå–œ    | profile.nicknameTier + æ¨¡æ¿æ¸²æŸ“    |
| Fâ€‘4 | **ä¸»åŠ¨ç§èŠ**   | è¢«åŠ¨æ–¹ä¹Ÿèƒ½æ”¶åˆ°å…³æ€€  | Scheduler + Discord Webhook    |
| Fâ€‘5 | **é¦–å•æ”¯ä»˜éªŒè¯** | è¯•æ¢ä»˜è´¹æ„æ„¿     | Creem æ”¯ä»˜å›è°ƒ & DOL æ‰£è´¹            |

> **å»¶ååŠŸèƒ½**ï¼šè®°å¿†ã€è¯­éŸ³ã€å›¾ç‰‡ã€å¤šæ¨¡æ€ã€å°æ¸¸æˆã€‚

### 2.2 ç”¨æˆ·æµç¨‹

```mermaid
graph TD
    U[ç”¨æˆ·å‘é€æ¶ˆæ¯] --> EMO[Emotion Detect]
    EMO --> HET[CalcÂ HET]
    HET --> INTI[Î”Intimacy]
    INTI --> DB[(Supabase Update)]
    DB --> AI[Generate Reply]
    AI --> REPLY[å›å¤+è¿›åº¦æ¡]
```

---

## 3Â Â·Â åŠŸèƒ½å®ç°è¯¦è§£

### 3.1 EmotionÂ Detect

```ts
valence âˆˆ {-1,0,1}
intensity âˆˆ [0,1]
emotionScore = valence * intensity
```

* æ¨¡å‹ï¼š`uer/roberta-base-finetuned-jd-binary-chinese`
* é˜ˆå€¼ï¼šç½®ä¿¡åº¦Â >Â 0.6 æ‰å®šææ€§

### 3.2 HET è®¡ç®—

```ts
tokens = text.length          // æ±‰å­—â‰ˆtoken
hetRaw = tokens * |emotionScore| * 1.2
HET    = clamp(round(hetRaw), 0, 100)
```

### 3.3 Î”Intimacy

```ts
function gain(HET){
  if(HET>=80) return 5;
  if(HET>=50) return 3;
  if(HET>=20) return 2;
  if(HET>=5)  return 1;
  return 0;
}
// 1h å†·å´å‡åŠ
gain = cooldown(userId, gain)
```

* è´Ÿæƒ…ç»ªå¯åŠ Â +1 å®‰æ…°åˆ† (å¯é…ç½®)

### 3.4 è¿›åº¦æ¡ Embed

```
â–ˆâ–“â–‘â–‘â–‘Â (34/60Â ğŸ’“)
```

* ä»…å½“Â Î”IntimacyÂ >Â 0 æ˜¾ç¤º

### 3.5 ä¸»åŠ¨ç§èŠ Scheduler

```cron
0 * * * *   // æ¯å°æ—¶æ£€æŸ¥
```

```sql
SELECT id FROM profiles
WHERE intimacy>=40
  AND last_msg_at < NOW()-INTERVAL '24 HOURS';
```

### 3.6 æ”¯ä»˜é—­ç¯

1. DOLÂ ä½™é¢Â <Â 30Â â†’Â æ‹¦æˆªå¼¹çª—
2. `/shop` é¦–å• â‰¥Â Â¥9.9ï¼š600Â DOLÂ + é™å®šè¯­éŸ³
3. `payments` è¡¨å†™å…¥åå¼‚æ­¥åŠ å¸

---

## 4Â Â·Â æŒ‡æ ‡è®¡ç®—ä¸ç›‘æ§

| æŒ‡æ ‡              | å…¬å¼                   | å·¥å…·                 |
| --------------- | -------------------- | ------------------ |
| **ä»˜è´¹è½¬åŒ–ç‡**       | é¦–æ¬¡å……å€¼äººæ•° / æ—¥æ´»          | Supabase â†’ Grafana |
| **Intimacy å‡å€¼** | avg(intimacy) by day | SQL Lens           |
| **å“åº”å»¶æ—¶**        | (t\_reply â€“ t\_user) | CloudWatch         |
| **D1 ç•™å­˜**       | æ¬¡æ—¥å‘é€æ¶ˆæ¯ç”¨æˆ·æ•° / æ—¥æ³¨å†Œ      | Supabase           |

---

## 5Â Â·Â ä»»åŠ¡è§„åˆ’ (4Â äºº/å¤©)

| Day | ä»»åŠ¡                    | Owner |
| --- | --------------------- | ----- |
| 1   | æƒ…æ„Ÿåˆ†ç±»å™¨å°è£… + HET å…¬å¼      | DevÂ A |
| 1â€‘2 | Î”Intimacy + DB schema | DevÂ B |
| 2   | Template æ¸²æŸ“ & è¿›åº¦æ¡     | DevÂ A |
| 2   | Creem æ”¯ä»˜å›è°ƒ            | DevÂ C |
| 3   | ä¸»åŠ¨ç§èŠ Scheduler        | DevÂ B |
| 3   | Discord Embed & UI QA | DevÂ A |
| 4   | æŒ‡æ ‡é¢æ¿ & è´Ÿè½½æµ‹è¯•           | DevÂ C |

---

## 6 Â· ä¸Šçº¿ Checklist ï¼ˆSolo ç‰ˆï¼‰

> **ç›®æ ‡**ï¼šä¸€ä¸ªäººä¹Ÿèƒ½å¿«é€Ÿã€å®‰å…¨å‘å¸ƒå¹¶éšæ—¶å›æ»šã€‚å…±åˆ†ä¸¤é˜¶æ®µï¼š**Tâ€‘1ï¼ˆå‰å¤œå‡†å¤‡ï¼‰** å’Œ **Tâ€‘0ï¼ˆä¸Šçº¿æ—¥ï¼‰**ã€‚

### 6.1Â Tâ€‘1Â â€“Â å‰å¤œå‡†å¤‡

* **ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ `.env.production` ä½¿ç”¨ç”Ÿäº§å¯†é’¥ï¼Œå¹¶å·²é€šè¿‡ Railway / Render åŠ å¯†ä¸Šä¼ ï¼›æœ¬åœ° `.env` ä¿ç•™æµ‹è¯•é…ç½®ã€‚
* **æ•°æ®åº“è¿ç§»ä¸å¤‡ä»½**ï¼šæ‰§è¡Œ `npm run migrate` æ›´æ–° Schemaï¼›éšåè¿è¡Œ `supabase db dump > backup_prelaunch.sql` ç”Ÿæˆå¤‡ä»½æ–‡ä»¶ã€‚
* **æ¨¡å‹é¢åº¦æ£€æŸ¥**ï¼šåœ¨ OpenRouter æ§åˆ¶å°ç¡®è®¤å‰©ä½™é¢åº¦ â‰¥ é¢„ä¼°æ—¥ç”¨é‡çš„ 3 å€ã€‚
* **æ”¯ä»˜é¢„éªŒ**ï¼šå°† Creem åˆ‡è‡³ç”Ÿäº§ç¯å¢ƒï¼Œè‡ªä»˜ Â¥0.01ï¼Œç¡®è®¤ `payments` è¡¨å†™å…¥ä¸” DOL å¢åŠ ã€‚
* **æœ¬åœ°å†’çƒŸæµ‹è¯•**ï¼š`npm run build && npm run test` å…¨ç»¿ï¼›`docker compose up` å¯åŠ¨å AI å›å¤æ­£å¸¸ã€‚

### 6.2Â Tâ€‘0Â â€“Â å‘å¸ƒä¸è‡ªæµ‹

* **éƒ¨ç½²**ï¼šåœ¨ Railway / Render ç‚¹å‡» *Deploy*ï¼›è‹¥æ—¥å¿—è¿ç»­ 5 åˆ†é’Ÿæ— æŠ¥é”™å³è§†ä¸ºæˆåŠŸã€‚
* **åŠŸèƒ½è‡ªæµ‹**ï¼š

  1. è¿ç»­å‘é€ 3 æ¡æ¶ˆæ¯ï¼Œç¡®è®¤å“åº” <Â 5â€¯ç§’ï¼Œäº²å¯†åº¦è¿›åº¦æ¡æ­£å¸¸ã€‚
  2. æ‰‹åŠ¨è€—å°½ DOL ä½™é¢ï¼ŒéªŒè¯å……å€¼æç¤ºã€‚
  3. å……å€¼ Â¥9.9ï¼Œç¡®è®¤ Creem å›è°ƒæˆåŠŸå¹¶ç¤¼åŒ…åˆ°è´¦ã€‚
* **æ•°æ®å¿«ç…§**ï¼šæ‰§è¡Œ `supabase db dump > backup_launch.sql` è®°å½•ä¸Šçº¿ååˆå§‹æ•°æ®ã€‚
* **å…¬å‘Š**ï¼šåœ¨ Discord `#announcements` é¢‘é“å‘å¸ƒä¸Šçº¿é€šçŸ¥ã€‚

### 6.3Â å›æ»šæ–¹æ¡ˆÂ å›æ»šæ–¹æ¡ˆÂ Tâ€‘0Â â€“Â å‘å¸ƒä¸è‡ªæµ‹

*

### 6.3Â å›æ»šæ–¹æ¡ˆ

* **æœåŠ¡å¼‚å¸¸**ï¼šRailway â†’ *Rollback* é€‰æ‹©ä¸Šä¸€é•œåƒã€‚
* **æ•°æ®å¼‚å¸¸**ï¼š`psql -f backup_prelaunch.sql` æ¢å¤ã€‚

### 6.4Â ä¸Šçº¿åé‡ç‚¹ç›‘æ§

| æŒ‡æ ‡                  | è§¦å‘è­¦æŠ¥é˜ˆå€¼       | å¿«é€Ÿæ£€æŸ¥æ–¹å¼                    |              |
| ------------------- | ------------ | ------------------------- | ------------ |
| **LatencyÂ p95**     | >â€¯5â€¯s        | Grafana é¢æ¿ `latency_p95`  |              |
| **ErrorÂ Rate**      | >â€¯2â€¯%        | \`tail -f logs            | grep ERROR\` |
| **PaymentÂ Failure** | >â€¯1 / 10â€¯min | Grafana `payments_failed` |              |
| **é¦–å•ä»˜è´¹ç‡**           | <â€¯8â€¯%ï¼ˆæ—¥ï¼‰     | Supabase SQL æ‰‹åŠ¨æŸ¥è¯¢         |              |
| **D1 ç•™å­˜ç‡**          | <â€¯70â€¯%ï¼ˆæ—¥ï¼‰    | Supabase SQL æ‰‹åŠ¨æŸ¥è¯¢         |              |

> æ¯å¤©èŠ± 10â€¯min æŸ¥çœ‹ Grafana ä¸ Supabaseï¼›å¼‚å¸¸å³æŸ¥çœ‹æ—¥å¿—æˆ–å›æ»šã€‚

## 7Â Â·Â åç»­è¿­ä»£è·¯çº¿Â Â·Â åç»­è¿­ä»£è·¯çº¿

1. **è®°å¿†åŠŸèƒ½**Â (ä¸Šä¸‹æ–‡æŒä¹…åŒ–)
2. **è¯­éŸ³Â +Â å›¾ç‰‡**Â (é«˜é˜¶èµ„äº§)
3. **å¥½å‹æ’è¡Œ**Â (ç¤¾äº¤ç«äº‰)
4. **Prompt è‡ªåŠ¨æ¼”åŒ–**Â (A/BÂ +Â RLHF)

> ğŸ—ï¸Â **åŸåˆ™**ï¼šä»»ä½•æ–°åŠŸèƒ½å¿…é¡»ç›´æ¥æå‡ *IntimacyÂ Engine* æˆ– *ä»˜è´¹è½¬åŒ–*.
> Â Â·Â åç»­è¿­ä»£è·¯çº¿

